# 插件简介
插件名称：astrbot_plugin_seedream_image  
作者：寰宇中的星尘  
版本：1.0.0  
描述：使用火山方舟Seedream API生成图片，触发指令为“画图豆包”，支持图片自动清理、防重复请求等增强功能  
标签：图片生成、火山方舟、Seedream、AstrBot、自动清理  

# 功能说明
该插件通过集成火山方舟Seedream API，实现根据用户文本提示词生成对应图片的功能，核心增强特性：
1. 自动适配火山方舟图片像素要求（最低3686400像素，默认1920x1920）；
2. 图片生成后保存到本地并通过AstrBot官方方式发送，兼容QQ群消息；
3. 发送完成后自动清理临时图片文件，避免磁盘冗余；
4. 防重复请求机制，避免用户短时间内重复触发；
5. 完善的错误处理（API Key无效、调用超限、参数错误等）。

# 插件流程
1. **消息监听**：插件监听用户消息，检测是否包含触发指令“画图豆包”；
2. **指令解析**：提取指令后的文本提示词，校验非空；
3. **防重校验**：检查用户是否有正在进行的生图任务，避免重复请求；
4. **API调用准备**：加载火山方舟API Key，校验图片尺寸合规性；
5. **调用Seedream API**：通过OpenAI兼容接口调用火山方舟图片生成接口；
6. **图片处理**：
   - 下载API返回的图片到插件专属本地目录；
   - 生成唯一文件名，避免文件冲突；
7. **结果反馈**：
   - 成功：通过AstrBot `chain_result` 发送本地图片到QQ群；
   - 失败：返回友好的错误提示（如API Key无效、调用超限等）；
8. **自动清理**：图片发送后延迟N秒自动删除本地临时文件；
9. **插件卸载**：清理所有残留的临时图片文件。

# 使用方法
1. **触发格式**：用户发送消息需遵循 `画图豆包 [文本提示词]` 的格式；
2. **示例操作**：
   - 用户输入：`画图豆包 夕阳下的海边，海鸥飞过`
   - 机器人响应：生成符合描述的图片并发送到QQ群，发送完成后自动清理本地文件；
3. **注意事项**：
   - 提示词需清晰、合规，避免使用模糊或违反法律法规的内容；
   - 同一用户短时间内仅支持一个生图任务，重复触发会提示“有正在进行的任务”。

# 配置说明
插件需配置以下参数才能正常工作，支持通过配置文件或环境变量注入：

| 配置项          | 类型   | 默认值                          | 说明                                                                 |
|-----------------|--------|---------------------------------|----------------------------------------------------------------------|
| VOLC_API_KEY    | string | ""                              | 火山方舟账号的API Key（需开通Seedream模型权限）                      |
| VOLC_ENDPOINT   | string | https://ark.cn-beijing.volces.com/api/v3 | 火山方舟API端点（可根据地域调整）                                   |
| image_size      | string | 1920x1920                       | 生成图片尺寸（需满足总像素≥3686400，支持1920x1920/2048x2048/3840x2160等） |
| model_version   | string | seedream-v1                     | Seedream模型版本                                                     |
| cleanup_delay   | int    | 10                              | 图片发送后自动清理延迟（秒），建议10~30秒                            |

**配置方式**：  
- 在插件配置文件（如 `astrbot_plugin_seedream_image.ini`）中填写：
  ```ini
  [astrbot_plugin_seedream_image]
  VOLC_API_KEY = 你的火山方舟API Key
  VOLC_ENDPOINT = https://ark.cn-beijing.volces.com/api/v3
  image_size = 1920x1920
  model_version = seedream-v1
  cleanup_delay = 10